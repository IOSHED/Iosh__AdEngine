{
    "title": "Ad Engine Monitoring",
    "description": "Automatic dashboard for Ad Engine metrics",
    "tags": ["ad-engine", "auto-generated"],
    "style": "dark",
    "timezone": "browser",
    "editable": false,
    "refresh": "30s",
    "panels": [
      {
        "type": "gauge",
        "title": "Total Clients",
        "gridPos": {"x":0,"y":0,"w":6,"h":4},
        "targets": [{
          "expr": "total_clients",
          "datasource": "Prometheus"
        }]
      },
      {
        "type": "gauge",
        "title": "Total Advertisers",
        "gridPos": {"x":6,"y":0,"w":6,"h":4},
        "targets": [{
          "expr": "total_advertisers",
          "datasource": "Prometheus"
        }]
      },
      {
        "type": "timeseries",
        "title": "Campaign Operations",
        "gridPos": {"x":0,"y":4,"w":12,"h":8},
        "targets": [
          {
            "expr": "sum(increase(campaigns_created_total[5m])) by (time_advance)",
            "legendFormat": "Created ({{time_advance}})"
          },
          {
            "expr": "sum(increase(campaigns_updated_total[5m])) by (time_advance)", 
            "legendFormat": "Updated ({{time_advance}})"
          },
          {
            "expr": "sum(increase(campaigns_deleted_total[5m])) by (time_advance)",
            "legendFormat": "Deleted ({{time_advance}})"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "decimals": 0
          }
        }
      },
      {
        "type": "timeseries",
        "title": "Ads Engagement",
        "gridPos": {"x":12,"y":4,"w":12,"h":8},
        "targets": [
          {
            "expr": "sum(ads_visits_total) by (time_advance)",
            "legendFormat": "Visits ({{time_advance}})"
          },
          {
            "expr": "sum(ads_clicks_total) by (time_advance)",
            "legendFormat": "Clicks ({{time_advance}})"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "decimals": 0
          }
        }
      },
      {
        "type": "timeseries",
        "title": "HTTP Requests",
        "gridPos": {"x":0,"y":12,"w":12,"h":8},
        "targets": [{
          "expr": "sum by(method, path) (increase(http_requests_total[5m]))",
          "legendFormat": "{{method}} {{path}}",
          "format": "time_series"
        }],
        "fieldConfig": {
          "defaults": {
            "unit": "none",
            "decimals": 0
          }
        }
      },
      {
        "type": "timeseries",
        "title": "Response Times",
        "gridPos": {"x":12,"y":12,"w":12,"h":8},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(http_response_time_seconds_bucket[5m])) by (le, method, path))",
            "legendFormat": "p95 {{method}} {{path}}"
          },
          {
            "expr": "histogram_quantile(0.50, sum(rate(http_response_time_seconds_bucket[5m])) by (le, method, path))",
            "legendFormat": "p50 {{method}} {{path}}"
          }
        ]
      }
    ]
}